import { A } from "@solidjs/router";
import { Note } from "catcolab-ui-components/alert";
import { HelpAnalysisById } from "../logic_help_detail"

## Description

**Stock and flow** (or simply **stock-flow**) diagrams are fundamental to systems dynamics.
They provide a rich language, allowing the scientist to model a system of **stocks** of various quantities and flows between them, with the rate of the flows depending in complex ways on various stocks via **links**.

<Note>
In CatColab we implement what we call **primitive** stock-flow diagrams, which do not allow for the auxiliary variables permitting flows to be arbitrary functions of the stocks (which is characteristic in systems dynamics), but instead simply products of the stocks with a constant rate.
We expect to implement the richer semantics in the future.
</Note>


### Examples

- [An SEIRV model](https://catcolab.org/model/0195001d-3c7d-7cb3-9019-2f411cfa2663/analysis/019b8f9a-8ed8-7a51-8a96-2cba807a892a)


### Further reading

- Wikipedia: [Stock and flow](https://en.wikipedia.org/wiki/Stock_and_flow)
- Pete Barbrook-Johnson, Alexandra S. Penn, "System Dynamics" in *Systems Mapping* (2022). [DOI:10.1007/978-3-031-01919-7](https://doi.org/10.1007/978-3-031-01919-7)
- John C. Baez, Xiaoyan Li, Sophie Libkind, Nathaniel D. Osgood, Eric Redekopp, "A Categorical Framework for Modeling with Stock and Flow Diagrams", (2023) [arXiv:2211.01290](https://arxiv.org/abs/2211.01290)


## Instances and analyses

### Analyses

<HelpAnalysisById theory={props.theory} analysisId="diagram"/>

<HelpAnalysisById theory={props.theory} analysisId="mass-action">
Stocks are interpreted as quantities that can vary in time, and the flows and links in the model determine equations constraining the time derivatives of the stocks.
Each stock is given an **initial value**.

Since this is mass-action dynamics, we make the assumption that flows depend only on their input stocks; since our stock-flow diagrams are *primitive*, flows are determined by constants (namely their rate coefficients).

The rest of the analysis depends on whether **mass conservation** is checked as true or false.

- If **mass conservation** is checked as *true*, a flow $S\overset{f}{\Rightarrow}T$ between stocks $S$ and $T$ gives the equations $\dot{S}=-r_fS$ and $\dot{T}=r_fS$, i.e. the flow $f$ goes out of $S$ and into $T$. Here, $r_f$ is the **rate coefficient** of the flow.

- If **mass conservation** is checked as *false*, then a flow has distinct **consumption** and **production**, giving the equations $\dot{S}=-\kappa_f$ and $\dot{T}=\rho_f$. Here, $\kappa_f$ and $\rho_f$ are the **consumption** and **production** rate coefficients of the flow.

In both cases, flows add linearly, i.e. in an arbitrary stock-flow diagram (without links), the equation governing a stock $S$ is $\dot{S}=\sum_{S_\text{in}}f_i - \sum_{S_\text{out}}f_j$, where $S_\text{in}$ (resp. $S_\text{out}$) is the set of all flows whose target (resp. source) is $S$.

Also in both cases, a link $R\to f$ from a stock $R$ to a flow $S\overset{f}{\Rightarrow}T$ modifies the the equation defining the flow by multiplication by $R$, i.e. without any link, we would have that $f=rS$, but introducing a link $R\to f$ enforces that $f=rSR$ instead.
</HelpAnalysisById>

<HelpAnalysisById theory={props.theory} analysisId="mass-action-equations"/>

<HelpAnalysisById theory={props.theory} analysisId="unbalanced-mass-action-equations"/>
